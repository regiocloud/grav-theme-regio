{% extends 'partials/base.html.twig' %}

{% set collection = page.collection() %}
    
{% block content %}
    <div class="services__banner">
        {% for banner in page.media.files %}
            {% if banner.basename|lower|contains('banner') %}
                <div class="services__banner__image">{{ banner }}</div>
            {% endif %}
        {% endfor %}
        {% for banner in page.media.images %}
            {% if banner.basename|lower|contains('banner') %}
                <div class="services__banner__image">{{ banner }}</div>
            {% endif %}
        {% endfor %}
        <div class="services__banner__content-wrapper inside">
            <div class="services__banner__content">
                {% for banner in page.header.banner %}
                    <h1>{{ banner.headline }}</h1>
                    <p>
                        <strong>{{ banner.strong }}</strong>
                        <br>
                        {{ banner.details }}
                    </p>
                    <div class="services__banner__content__button-wrapper">
                        <div class="services__banner__content__button ">
                            <a href="{{ banner.cta_link }}" title="{{ banner.cta_name }}" rel="noopener" target="_blank">
                                {{ banner.cta_content }}
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <article class="services inside">
        {% set hasSoftwareChild = false %}
        {% for child in collection %}
            {% if 'software' in child.taxonomy.tag %}
                {% set hasSoftwareChild = true %}
            {% endif %}
        {% endfor %}
        {% if hasSoftwareChild %}
            <section class="services__content">
                <h2>Software</h2>
                    <p class="services__content__topic-description">{{ page.header.topic_descriptions.software }}</p>
                <div class="services__content__boxes">
                {% for child in collection|filter(child => 'software' in child.taxonomy.tag) %}
                    {% include 'partials/service_item.html.twig' with {'services':page, 'page':child, 'truncate':true, 'expanded':true} %}
                {% endfor %}
                </div>
            </section>
        {% endif %}
        {% set hasPlatformChild = false %}
        {% for child in collection %}
            {% if 'platform' in child.taxonomy.tag %}
                {% set hasPlatformChild = true %}
            {% endif %}
        {% endfor %}
        {% if hasPlatformChild %}
            <section class="services__content">
                <h2>Plattformen</h2>
                    <p class="services__content__topic-description">{{page.header.topic_descriptions.platforms}}</p>
                <div class="services__content__boxes">
                {% for child in collection|filter(child => 'platform' in child.taxonomy.tag) %}
                    {% include 'partials/service_item.html.twig' with {'services':page, 'page':child, 'truncate':true, 'expanded':true} %}
                {% endfor %}
                </div>
            </section>
        {% endif %}
        {% set hasInfrastructureChild = false %}
        {% for child in collection %}
            {% if 'infrastructure' in child.taxonomy.tag %}
                {% set hasInfrastructureChild = true %}
            {% endif %}
        {% endfor %}
        {% if hasInfrastructureChild %}
            <section class="services__content">
                <h2>Infrastruktur</h2>
                    <p class="services__content__topic-description">{{ page.header.topic_descriptions.infrastructure }}</p>
                <div class="services__content__boxes">
                {% for child in collection|filter(child => 'infrastructure' in child.taxonomy.tag) %}
                    {% include 'partials/service_item.html.twig' with {'services':page, 'page':child, 'truncate':true, 'expanded':true} %}
                {% endfor %}
                </div>
            </section>
        {% endif %}
        {% for child in collection %}
            {% if child.folder() == 'contact' %}
                <section class="contact contact--services">
                    <div class="contact__content">
                        <h2>{{ child.title }}</h2>
                        {{ child.content}}
                    </div>
                    <div class="contact__form-wrapper">
                        {% include "forms/form.html.twig" with {'childFrontmatter': page.header} %}
                    </div>
                </section>
            {% endif %}
        {% endfor %}
    </article>
{% endblock %}